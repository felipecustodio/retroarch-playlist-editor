/* MarcDataTable.js v20220404 - Marc Robledo 2014-2022 - http://www.marcrobledo.com/license */
var MarcDataTable=function(){function a(a,b,c){j?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)}function b(a,b,c){j?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)}function c(a){"undefined"==typeof a.stopPropagation?a.cancelBubble=!0:a.stopPropagation()}function d(a){a.preventDefault?a.preventDefault():a.returnValue=!1}function e(){document.body.className=document.body.className.replace(/ moving-rows$/g,""),p(),o&&(o.tBody.className=o.tBody.className.replace(/ moving-rows$/g,"")),m=0,n=0,o=null}function f(a){if(this._disabled)return!1;if(a=a||window.event,c(a),d(a),1!==a.which)return!1;if(o){if(this._dragAndDropGroup&&this._dragAndDropGroup===o._dragAndDropGroup&&!this.isSelected(this._data[r(a,this)])){var b=o.getSelectedElements(),f=o.removeSelected(!0),g=this._data.indexOf(l);-1!==g&&(!q(a,l._dataTableRow)&&g++,this.add(f,!0,g,!0),this.focus(g),this.triggerOnChange(f,"moved"))}e()}else if(!a.shiftKey&&!a.ctrlKey){var h=r(a,this);this.isSelected(h)&&(this.deselectAll(),this.select(h),this.focus(h))}m=0,n=0}function g(a){return!this._disabled&&void(a=a||window.event,o?(p(),l=this._data[r(a,this)],this._dragAndDropGroup&&this._dragAndDropGroup===o._dragAndDropGroup&&!this._isSelectedElement(l)&&(q(a,l._dataTableRow)?l._dataTableRow.className+=" row-over row-over-top":l._dataTableRow.className+=" row-over row-over-bottom")):1===a.which&&m&&n&&(16<Math.abs(m-a.clientX)||16<Math.abs(n-a.clientY))&&(o=this,document.body.className+=" moving-rows",this.tBody.className+=" moving-rows",m=0,n=0))}function h(a){if(this._disabled)return!1;if(a=a||window.event,c(a),d(a),1===a.which){this._dragAndDropGroup&&(m=a.clientX,n=a.clientY);var b=r(a,this);if(-1!==b){if(a.shiftKey){var e=0;this._selectedElements.length&&this._focusedElement&&(e=this._data.indexOf(this._rangeMode?this._selectedElements[0]:this._focusedElement)),this.deselectAll(!0),this.selectRange(e,b)}else a.ctrlKey?this.toggle(b):this.isSelected(b)||(this.deselectAll(!0),this.select(b,!0));this.focus(b)}w&&w!==this&&w.blur()}else if(3===a.which)var b=r(a,this)}function i(b,e){this.tBody=b,this._data=e,this._dragAndDropGroup=!1,this._disabled=!1,this.onChange=!1,this.onSelect=!1,a(this.tBody,"click",c),a(this.tBody,"contextmenu",d),a(this.tBody,"mousedown",h.bind(this)),a(this.tBody.parentElement,"mouseup",f.bind(this)),this._selectedElements=[],this._focusedElement=null,this._rangeMode=!1,this.refresh()}var j=/MSIE 8/.test(navigator.userAgent);if(Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),"function"==typeof Array.isArray)var k=Array.isArray;else var k=function(a){return"object"===a&&"number"==typeof a.length};var l,m=0,n=0,o=null,p=function(){l&&(l._dataTableRow.className=l._dataTableRow.className.replace(/ row-over row-over-(top|bottom)/g,""))},q=function(a,b){var c=b.getBoundingClientRect();return a.clientY-c.top<c.height/2},r=function(a,b){for(var c=a.target||a.srcElement,d=[].slice.call(b.tBody.children),e=-1;-1===e&&"undefined"!=typeof c&&c&&c!==document.body;)c.parentElement===b.tBody&&(e=d.indexOf(c)),c=c.parentElement;return e},s=function(a,b,c){b._dataTableRow.className=c?"row row-selected":"row",w===a&&a._focusedElement===b&&(b._dataTableRow.className+=" row-focused"),"function"==typeof b.getDataTableClassName&&(b._dataTableRow.className+=" "+b.getDataTableClassName())},t=function(a,b,c){if(!b._dataTableRow)if(b._dataTableRow=document.createElement("tr"),"function"==typeof b.getDataTableCells){var d=b.getDataTableCells();("object"!=typeof d||"number"!=typeof d.length)&&(d=[null]);for(var e=0;e<d.length;e++)b._dataTableRow.appendChild(document.createElement("td"))}else b._dataTableRow.appendChild(document.createElement("td"));u(a,b,c)},u=function(a,b,c){if(s(a,b,c),"function"==typeof b.getDataTableCells){var d=b.getDataTableCells();k(d)||(d=["No cell data found"]);for(var e=0;e<d.length;e++)b._dataTableRow.children[e].innerHTML=d[e]}else b._dataTableRow.children[e].innerHTML="No cell data found"},v=function(c){return c._selectedElements.slice().sort(function(d,a){return c._data.indexOf(d)-c._data.indexOf(a)})};i.prototype.setDisabled=function(a){this._disabled=!!a,this._disabled&&(this.blur(),this.deselectAll())},i.prototype.enableDragAndDrop=function(b){b||(b="default"),this._dragAndDropGroup||(a(this.tBody,"mouseout",p),a(this.tBody,"mousemove",g.bind(this))),this._dragAndDropGroup=b.toString()},i.prototype.disableDragAndDrop=function(){this._dragAndDropGropup&&(b(this.tBody,"mouseout",this.tBody.onmouseout),b(this.tBody,"mousemove",this.tBody.onmousemove),this._dragAndDropGroup=!1)},i.prototype.refresh=function(a){if("undefined"==typeof a){this.tBody.innerHTML="";for(var b=0;b<this._data.length;b++)t(this,this._data[b],this._isSelectedElement(this._data[b])),this.tBody.appendChild(this._data[b]._dataTableRow)}else{k(a)||(a=[a]);for(var b=0;b<a.length;b++)"number"==typeof a[b]&&(a[b]=this._data[a[b]]),u(this,a[b],this._isSelectedElement(a[b]))}},i.prototype.sort=function(a,b){b?this._data.sort(a).reverse():this._data.sort(a),this.refresh()},i.prototype.reverse=function(){this._data.reverse(),this.refresh()},i.prototype.setData=function(a){this._data=a,this.refresh()},i.prototype.getLength=function(){return this._data.length},i.prototype.getData=function(){return this._data},i.prototype.triggerOnSelect=function(){if("function"==typeof this.onSelect){for(var a=Array(this._selectedElements.length),b=this.getSelectedElements(),c=0;c<b.length;c++)a[c]=this._data.indexOf(b[c]);this.onSelect.bind(this,b,a).call()}},i.prototype.triggerOnChange=function(a,b){"function"==typeof this.onChange&&this.onChange.bind(this,a,b).call()},i.prototype._isSelectedElement=function(a){return 0<=this._selectedElements.indexOf(a)},i.prototype.isSelected=function(a){return"number"==typeof a&&(a=this._data[a]),this._isSelectedElement(a)},i.prototype.getSelectedElements=function(){return v(this)},i.prototype.getSelectedIndexes=function(){for(var a=Array(this._selectedElements.length),b=this.getSelectedElements(),c=0;c<b.length;c++)a[c]=this._data.indexOf(b[c]);return a},i.prototype.getElementIndex=function(a){return this._data.indexOf(a)},i.prototype._selectOne=function(a){this._isSelectedElement(a)||(this._selectedElements.push(a),s(this,a,!0))},i.prototype.select=function(a,b){k(a)||(a=[a]);for(var c=0;c<a.length;c++)this._selectOne("number"==typeof a[c]?this._data[a[c]]:a[c]);b||this.triggerOnSelect()},i.prototype.selectOnly=function(a,b){k(a)||(a=[a]);for(var c=0;c<a.length;c++)"number"==typeof a[c]&&(a[c]=this._data[a[c]]);for(var d=[],c=0;c<this._selectedElements.length;c++)-1===a.indexOf(this._selectedElements[c])&&d.push(this._selectedElements[c]);this.deselect(d,!0),this.select(a,b)},i.prototype.selectAll=function(a){this.select(this._data.slice(),a)},i.prototype._deselectOne=function(a){this._isSelectedElement(a)&&(s(this,a,!1),this._selectedElements.splice(this._selectedElements.indexOf(a),1))},i.prototype.deselect=function(a,b){k(a)||(a=[a]);for(var c=0;c<a.length;c++)this._deselectOne("number"==typeof a[c]?this._data[a[c]]:a[c]);b||this.triggerOnSelect()},i.prototype.deselectAll=function(a){this.deselect(this._selectedElements.slice(),a)},i.prototype.toggle=function(a,b){k(a)||(a=[a]);for(var c=0;c<a.length;c++)this.isSelected(a[c])?this._deselectOne("number"==typeof a[c]?this._data[a[c]]:a[c]):this._selectOne("number"==typeof a[c]?this._data[a[c]]:a[c]);this._rangeMode=!1,b||this.triggerOnSelect()},i.prototype.selectInverse=function(a){this.toggle(this._data.slice(),a)},i.prototype.selectRange=function(a,b,c){"undefined"==typeof b?b=this._data.length-1:0>b?b=0:a>this._data.length-1&&(b=this._data.length-1),0>a?a=0:a>this._data.length-1&&(a=this._data.length-1);var d=[];if(a<b)for(var e=a;e<=b;e++)d.push(this._data[e]);else for(var e=a;e>=b;e--)d.push(this._data[e]);d.length&&(this.select(d,c),this._rangeMode=!0)},i.prototype.focus=function(a){if("number"==typeof a?a=this._data[a]:"undefined"==typeof a&&(this._focusedElement?a=this._focusedElement:this._data.length&&(a=this._data[0])),document.activeElement.blur(),w!==this&&(w&&w.blur(),w=this),a){var b=this._focusedElement;this._focusedElement=a,s(this,this._focusedElement,this._isSelectedElement(this._focusedElement)),b&&b!==this._focusedElement&&s(this,b,this._isSelectedElement(b))}},i.prototype.blur=function(){var a=this._focusedElement;w===this&&(w=null,a&&s(this,a,this._isSelectedElement(a)))},i.prototype.getFocus=function(){return this._focusedElement},i.prototype.getFocusIndex=function(){return this._data.indexOf(this._focusedElement)},i.prototype.remove=function(a,b){k(a)||(a=[a]);for(var c=this.getFocusIndex(),d=[],e=0;e<a.length;e++){"number"==typeof a[e]&&(a[e]=this._data[a[e]]);var f=this._data.indexOf(a[e]);-1!==f&&(this._isSelectedElement(a[e])&&this._deselectOne(a[e]),this.tBody.removeChild(a[e]._dataTableRow),this._data.splice(f,1),d.push(a[e]))}return this.blur(),c>=this._data.length?this.focus(this._data.length-1):this.focus(c),this._rangeMode=!1,d.length&&!b&&(this.triggerOnSelect(),this.triggerOnChange(d,"removed")),d},i.prototype.removeSelected=function(a){return this.remove(this.getSelectedElements(),a)},i.prototype.empty=function(a){return this.selectAll(!0),this.removeSelected(a)},i.prototype.add=function(a,b,c,d){"undefined"==typeof c&&(c=this._data.length),b&&this.deselectAll(!0);var e=[];k(a)||(a=[a]);for(var f=0;f<a.length;f++)-1===this._data.indexOf(a[f])&&(t(this,a[f]),c+f<this._data.length?(this.tBody.insertBefore(a[f]._dataTableRow,this.tBody.children[c+f]),this._data.splice(c+f,0,a[f])):(this.tBody.appendChild(a[f]._dataTableRow),this._data.push(a[f])),e.push(a[f]));return b&&this.selectRange(c,c+e.length-1),e.length&&!d&&this.triggerOnChange(e,"added"),e},i.prototype.append=function(a,b,c){this.add(a,b,this._data.length,c)},i.prototype.prepend=function(a,b,c){this.add(a,b,0,c)};var w=null;document.addEventListener("visibilitychange",function(){("hidden"===document.visibilityState||!1===document.hidden)&&e()}),a(window,"load",function(){a(window,"click",i.deselect)}),a(window,"mousedown",function(){w&&w.blur(),e()}),a(window,"mouseup",function(){e()}),a(window,"keydown",function(a){if(document.activeElement===document.body)if(27===a.keyCode||9===a.keyCode)o&&e(),w&&w.blur();else if(38!==a.keyCode&&40!==a.keyCode&&33!==a.keyCode&&34!==a.keyCode&&36!==a.keyCode&&35!==a.keyCode)32===a.keyCode&&w&&!w._disabled&&(d(a),w.toggle(w.getFocusIndex()));else if(w&&!w._disabled){d(a);var b=w.getFocusIndex();if(!o&&((38===a.keyCode||33===a.keyCode||36===a.keyCode)&&0<b||(40===a.keyCode||34===a.keyCode||35===a.keyCode)&&b<w.tBody.children.length-1)){var c=w.getFocusIndex();if(38===a.keyCode?c--:40===a.keyCode?c++:33===a.keyCode?c-=10:34===a.keyCode?c+=10:36===a.keyCode?c-=w._data.length:35===a.keyCode&&(c+=w._data.length),0>c?c=0:c>=w._data.length&&(c=w._data.length-1),a.shiftKey){var f=w._rangeMode?w._data.indexOf(w._selectedElements[0]):w.getFocusIndex();w.deselectAll(),w.selectRange(f,c)}else a.ctrlKey||(w._rangeMode=!1,w.deselectAll(),w.select(c));w.focus(c)}}});var x=function(a){return"string"==typeof a&&(/^#[a-zA-Z0-9_\-]+$/?a=document.getElementById(a.replace("#","")):a=document.querySelector(a)),"object"==typeof a&&"string"==typeof a.tagName&&("THEAD"===a.tagName&&(a=a.parentElement),"TABLE"===a.tagName&&(a=a.tBodies[0],!a&&(a=document.createElement("tbody"),a.parentElement.appendChild(a))),"TBODY"===a.tagName)?a:null};return{enable:function(a,b){return a=x(a),k(b)||(b=[]),a?new i(a,b):null},getFocus:function(){return w}}}();